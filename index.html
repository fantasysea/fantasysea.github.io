<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.1.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.2">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.2" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Steve&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Steve&#39;s Blog">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Steve&#39;s Blog">





  
  
  <link rel="canonical" href="http://yoursite.com/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Steve's Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Steve's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">stay foolish,stay hungery</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/04/Android串口通讯/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Steve">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Steve's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/04/Android串口通讯/" class="post-title-link" itemprop="url">Android串口通讯</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-04 09:24:41 / 修改时间：09:25:56" itemprop="dateCreated datePublished" datetime="2019-07-04T09:24:41+08:00">2019-07-04</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术总结/" itemprop="url" rel="index"><span itemprop="name">技术总结</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="串口通讯"><a href="#串口通讯" class="headerlink" title="串口通讯"></a>串口通讯</h1><p>串口通讯我们需要直接操作节点文件，一般是tty*。tty是电传打印机的意思，是个人计算机出现之前就已经有了的物种。我们知道，计算机的数据都是01，那么很容易用高低电平模拟数据的传输。那么必须要有个协议来规范，如：RS-232，ttl等</p>
<h2 id="UART"><a href="#UART" class="headerlink" title="UART"></a>UART</h2><p>UART个人理解就是一个ic芯片，控制什么时候收发数据，发数据的时候可以用RS232等协议发。</p>
<h2 id="串行数据的格式"><a href="#串行数据的格式" class="headerlink" title="串行数据的格式"></a>串行数据的格式</h2><p>以下参数<a href="https://blog.csdn.net/qq_29350001/article/details/72730667" target="_blank" rel="noopener">来之</a><br>异步串行数据的一般格式是：起始位+数据位+停止位，(8-N-1格式) 其中起始位1 位，数据位可以是5、6、7、8位，停止位可以是1、1.5、2位。<br>起始位是一个值为0的位，所以对于正逻辑的TTL电平，起始位是一位时间的低电平；停止位是值为1的位，所以对于正逻辑的TTL电平，停止位是高电平。线路路空闲或者数据传输结束，对于正逻辑的TTL电平，线路总是1。对于负逻辑(如RS-232电平)则相反。</p>
<p>例如，对于16进制数据55aaH，当采用8位数据位、1位停止位传输时，它在信号线上的波形如图1(TTL电平)和图2(RS-232电平)所示。 （先传第一个字节55，再传第二个字节aa，每个字节都是从低位向高位逐位传输）<br><img src="https://img-blog.csdn.net/20170525163526578" alt="TTL电平的串行数据帧格式(55aah)"></p>
<p>图1 TTL电平的串行数据帧格式(55aah)</p>
<p><img src="https://img-blog.csdn.net/20170525163541454" alt="RS-232电平的串行数据帧格式(55aah)"></p>
<p>图2 RS-232电平的串行数据帧格式(55aah)</p>
<h2 id="根据波形图计算波特率"><a href="#根据波形图计算波特率" class="headerlink" title="根据波形图计算波特率"></a>根据波形图计算波特率</h2><p>波特率就是一秒内的传输的码元，一个码元相当于一个高或者低电平。类似进行了一次0 1 操作就是2个码元。一个字节是8位，那么比特率是9600的时候，1秒能传输 9600/8 = 1200 byte=1.2 kb 波特率越高，那么传输速度越快。115200/8 = 14400/1024 = 14m每秒。那是相当大的一个数据了。不过由于串口中有起始位和结束位，所以实际有效数据并没那么多。</p>
<p>如图3是图1在示波器中的显示示意，其中灰色线是示波器的时间分度线，此时假设是200us/格。 </p>
<p><img src="https://img-blog.csdn.net/20170525163619407" alt="图3 波特率计算示意图"> </p>
<p>图3 波特率计算示意图 </p>
<p>可以看了，第一个字节的10位(1位起始位，8位数据位和1位停止位)共占约1.05ms，这样可计算出其波特率约为：<br>10bit / 1.05ms X 1000 ≈ 9600 bit/s<br>如果上图中的时间轴是100us/格，同样可以计算出波特率应是19200bit/s。<br>当通讯不正常，又能观察到波形时，就可根据上述方法，从波形图计算一下波特率是否正确。</p>
<h2 id="串口通讯流程"><a href="#串口通讯流程" class="headerlink" title="串口通讯流程"></a>串口通讯流程</h2><p>串口的操作一般都通过四个步骤来完成：<br>1、打开串口<br>2、配置串口：对串口的波特率、数据位、停止位、校验码、等进行设置。<br>3、读写串口<br>4、关闭串口</p>
<h2 id="Android中实现串口通讯"><a href="#Android中实现串口通讯" class="headerlink" title="Android中实现串口通讯"></a>Android中实现串口通讯</h2><p>普遍我们使用的是google实现的一个方案 <a href="https://code.google.com/archive/p/android-serialport-api/" target="_blank" rel="noopener">android-serialport-api</a> 我们项目中也一直这样使用。后来发现Android源码中有一个串口通讯的例子<a href="http://androidxref.com/8.1.0_r33/xref/frameworks/base/tests/SerialChat/" target="_blank" rel="noopener">SerialChat</a>，使用的是<a href="http://androidxref.com/8.1.0_r33/xref/frameworks/base/core/jni/android_hardware_SerialPort.cpp" target="_blank" rel="noopener">android_hardware_SerialPort.cpp</a>的open方法实现的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#include &quot;utils/Log.h&quot;</span><br><span class="line">#include &quot;jni.h&quot;</span><br><span class="line">#include &quot;JNIHelp.h&quot;</span><br><span class="line">#include &quot;android_runtime/AndroidRuntime.h&quot;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;sys/stat.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">#include &lt;termios.h&gt;</span><br><span class="line">using namespace android;</span><br><span class="line">static jfieldID field_context;</span><br><span class="line">static void</span><br><span class="line">android_hardware_SerialPort_open(JNIEnv *env, jobject thiz, jobject fileDescriptor, jint speed)</span><br><span class="line">&#123;</span><br><span class="line">    switch (speed) &#123;</span><br><span class="line">        case 50:</span><br><span class="line">            speed = B50;</span><br><span class="line">            break;</span><br><span class="line">        case 75:</span><br><span class="line">            speed = B75;</span><br><span class="line">            break;</span><br><span class="line">        case 110:</span><br><span class="line">            speed = B110;</span><br><span class="line">            break;</span><br><span class="line">        case 134:</span><br><span class="line">            speed = B134;</span><br><span class="line">            break;</span><br><span class="line">        case 150:</span><br><span class="line">            speed = B150;</span><br><span class="line">            break;</span><br><span class="line">        case 200:</span><br><span class="line">            speed = B200;</span><br><span class="line">            break;</span><br><span class="line">        case 300:</span><br><span class="line">            speed = B300;</span><br><span class="line">            break;</span><br><span class="line">        case 600:</span><br><span class="line">            speed = B600;</span><br><span class="line">            break;</span><br><span class="line">        case 1200:</span><br><span class="line">            speed = B1200;</span><br><span class="line">            break;</span><br><span class="line">        case 1800:</span><br><span class="line">            speed = B1800;</span><br><span class="line">            break;</span><br><span class="line">        case 2400:</span><br><span class="line">            speed = B2400;</span><br><span class="line">            break;</span><br><span class="line">        case 4800:</span><br><span class="line">            speed = B4800;</span><br><span class="line">            break;</span><br><span class="line">        case 9600:</span><br><span class="line">            speed = B9600;</span><br><span class="line">            break;</span><br><span class="line">        case 19200:</span><br><span class="line">            speed = B19200;</span><br><span class="line">            break;</span><br><span class="line">        case 38400:</span><br><span class="line">            speed = B38400;</span><br><span class="line">            break;</span><br><span class="line">        case 57600:</span><br><span class="line">            speed = B57600;</span><br><span class="line">            break;</span><br><span class="line">        case 115200:</span><br><span class="line">            speed = B115200;</span><br><span class="line">            break;</span><br><span class="line">        case 230400:</span><br><span class="line">            speed = B230400;</span><br><span class="line">            break;</span><br><span class="line">        case 460800:</span><br><span class="line">            speed = B460800;</span><br><span class="line">            break;</span><br><span class="line">        case 500000:</span><br><span class="line">            speed = B500000;</span><br><span class="line">            break;</span><br><span class="line">        case 576000:</span><br><span class="line">            speed = B576000;</span><br><span class="line">            break;</span><br><span class="line">        case 921600:</span><br><span class="line">            speed = B921600;</span><br><span class="line">            break;</span><br><span class="line">        case 1000000:</span><br><span class="line">            speed = B1000000;</span><br><span class="line">            break;</span><br><span class="line">        case 1152000:</span><br><span class="line">            speed = B1152000;</span><br><span class="line">            break;</span><br><span class="line">        case 1500000:</span><br><span class="line">            speed = B1500000;</span><br><span class="line">            break;</span><br><span class="line">        case 2000000:</span><br><span class="line">            speed = B2000000;</span><br><span class="line">            break;</span><br><span class="line">        case 2500000:</span><br><span class="line">            speed = B2500000;</span><br><span class="line">            break;</span><br><span class="line">        case 3000000:</span><br><span class="line">            speed = B3000000;</span><br><span class="line">            break;</span><br><span class="line">        case 3500000:</span><br><span class="line">            speed = B3500000;</span><br><span class="line">            break;</span><br><span class="line">        case 4000000:</span><br><span class="line">            speed = B4000000;</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            jniThrowException(env, &quot;java/lang/IllegalArgumentException&quot;,</span><br><span class="line">                              &quot;Unsupported serial port speed&quot;);</span><br><span class="line">            return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    int fd = jniGetFDFromFileDescriptor(env, fileDescriptor);</span><br><span class="line">    // duplicate the file descriptor, since ParcelFileDescriptor will eventually close its copy</span><br><span class="line">    fd = dup(fd);</span><br><span class="line">    if (fd &lt; 0) &#123;</span><br><span class="line">        jniThrowException(env, &quot;java/io/IOException&quot;, &quot;Could not open serial port&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    env-&gt;SetIntField(thiz, field_context, fd);</span><br><span class="line">    struct termios tio;</span><br><span class="line">    if (tcgetattr(fd, &amp;tio))</span><br><span class="line">        memset(&amp;tio, 0, sizeof(tio));</span><br><span class="line">    tio.c_cflag =  speed | CS8 | CLOCAL | CREAD;</span><br><span class="line">    // Disable output processing, including messing with end-of-line characters.</span><br><span class="line">    tio.c_oflag &amp;= ~OPOST;//原始数据输出</span><br><span class="line">    tio.c_iflag = IGNPAR;//忽略桢错误和奇偶校验错</span><br><span class="line">    tio.c_lflag = 0; /* turn of CANON, ECHO*, etc *///关闭本地处理</span><br><span class="line">    /* no timeout but request at least one character per read */</span><br><span class="line">    tio.c_cc[VTIME] = 0;</span><br><span class="line">    tio.c_cc[VMIN] = 1;//最小读取到1个字节就返回</span><br><span class="line">    tcsetattr(fd, TCSANOW, &amp;tio);</span><br><span class="line">    tcflush(fd, TCIFLUSH);//如果发生数据溢出，接收数据，但是不再读取</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>与<a href="https://code.google.com/archive/p/android-serialport-api/" target="_blank" rel="noopener">android-serialport-api</a> 对比，termios的设置更加丰富。那么我们必须要了解termios的各种设置是什么意思才能确认哪个方案更加适合自己。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">struct termios</span><br><span class="line">      &#123;</span><br><span class="line">      tcflag_t  c_iflag;  //输入选项</span><br><span class="line">      tcflag_t  c_oflag;  //输出选项</span><br><span class="line">      tcflag_t  c_cflag;  //控制选项</span><br><span class="line">      tcflag_t  c_lflag;  //行选项</span><br><span class="line">      cc_t      c_cc[NCCS]; //控制字符</span><br><span class="line">      &#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    //修改控制模式，保证程序不会占用串口</span><br><span class="line">    options.c_cflag |= CLOCAL;</span><br><span class="line">    //修改控制模式，使得能够从串口中读取输入数据</span><br><span class="line">    options.c_cflag |= CREAD;</span><br><span class="line"></span><br><span class="line">`</span><br></pre></td></tr></table></figure>

<p>关于termios的设置和参数非常多也复杂，我收集了几篇文章给大家参考.c_iflag，c_oflag，c_cflag等这些控制位的赋值一般都是 | &amp;的方式，<br>比如：<br>c_cflag |= CLOCAL;//忽略 modem 控制线<br>c_oflag &amp;= ~OPOST;//原始数据输出  ~就是非，取反的意思。</p>
<p>控制字符<em>c_cc</em>中VTIME, VMIN 比较重要，VTIME就是超时时间，可以不设置，VMIN是最小读取数据量。他们组合起来会有各种玩法。摘录了一下：</p>
<p>*
控制符VTIME和VMIN之间有复杂的关系。VTIME定义要求等待的时间（百毫米，通常是unsigned char变量），而VMIN定义了要求等待的最小字节数（相比之下，read函数的第三个参数指定了要求读的最大字节数）。<br>如果VTIME=0，VMIN=要求等待读取的最小字节数，read必须在读取了VMIN个字节的数据或者收到一个信号才会返回。<br>如果VTIME=时间量，VMIN=0，不管能否读取到数据，read也要等待VTIME的时间量。<br>如果VTIME=时间量，VMIN=要求等待读取的最小字节数，那么将从read读取第一个字节的数据时开始计时，并会在读取到VMIN个字节或者VTIME时间后返回。<br>如果VTIME=0，VMIN=0，不管能否读取到数据，read都会立即返回。</p>
<p>*</p>
<ul>
<li><a href="https://blog.csdn.net/qq_29350001/article/details/72730667" target="_blank" rel="noopener">UNIX再学习 – RS485 串口编程</a></li>
<li><a href="http://www.man7.org/linux/man-pages/man3/termios.3.html" target="_blank" rel="noopener">Linux Programmer’s Manual  TERMIOS(3)</a></li>
<li><a href="https://blog.csdn.net/freezgw1985/article/details/5789190" target="_blank" rel="noopener">linux 串口编程</a></li>
<li><a href="https://www.cnblogs.com/xiaojianliu/p/8473113.html" target="_blank" rel="noopener">串口编程2：编程基础</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/04/客显数据抓包分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Steve">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Steve's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/04/客显数据抓包分析/" class="post-title-link" itemprop="url">客显数据抓包分析</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-04 09:21:50 / 修改时间：09:24:13" itemprop="dateCreated datePublished" datetime="2019-07-04T09:21:50+08:00">2019-07-04</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术总结/" itemprop="url" rel="index"><span itemprop="name">技术总结</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="客显数据抓包分析"><a href="#客显数据抓包分析" class="headerlink" title="客显数据抓包分析"></a>客显数据抓包分析</h1><p>因为公司项目需要抓取客显的数据，客显数据大部分基于这个<a href="https://wenku.baidu.com/view/6c1b07aef78a6529657d5380.html" target="_blank" rel="noopener">通用协议</a>，个人理解，这个协议是基于ESC/POS协议的改良版。由于软件要抓取这些数据，分析出价格，所以需要先知道这些协议的格式形式。基于思迅天店的客显选择(多达48款)，我抓起了设置不同客显的时候的数据包，也抓了对应的波特率供大家参考（抓取数据真的很抓狂，搞了一个晚上）。</p>
<blockquote>
<p>QA/QB 是显示第一行和第二行用的<br>大部分加商品的时候发的指令是QA:12.33或者 QA合计:12.33，但是英文客显很多是QBTOT：12.33，但是也有直接S4 12.33 这样的</p>
</blockquote>
<p>有一些客显有2行，那么第一行他们会显示单价，第二行显示总价，类似 <code>QASUB:            0.15QBTOT:          497.55</code></p>
<p><strong>客显使用的是<a href="https://cdn.barcodediscount.com/resources/CD5220_Manual.pdf" target="_blank" rel="noopener">CD-5220-ii</a>或ESC/POS指令集，这些指令集使用了控制符当协议，打印出来的话变成乱码，所以我再第二行填写了对应的ACSII码参考</strong></p>
<h1 id="中文客显"><a href="#中文客显" class="headerlink" title="中文客显"></a>中文客显</h1><h2 id="寺冈中文客显（9600）"><a href="#寺冈中文客显（9600）" class="headerlink" title="寺冈中文客显（9600）"></a>寺冈中文客显（9600）</h2><p>这是通过拿到的byte数据转 new String(date,”gbk”)获取到的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QA合计:        531607.11</span><br><span class="line">ESCQA合计:        531607.11</span><br></pre></td></tr></table></figure>

<h2 id="隆宝LANPOS-IC-851-11位数字五组汉字（9600）"><a href="#隆宝LANPOS-IC-851-11位数字五组汉字（9600）" class="headerlink" title="隆宝LANPOS IC-851 11位数字五组汉字（9600）"></a>隆宝LANPOS IC-851 11位数字五组汉字（9600）</h2><p>这是通过拿到的byte数据转 new String(date,”gbk”)获取到的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QA合计:        531607.11</span><br><span class="line">ESCQA合计:        531607.11</span><br></pre></td></tr></table></figure>

<h2 id="隆宝LANPOS-IC-85B-双行英文型（9600）"><a href="#隆宝LANPOS-IC-85B-双行英文型（9600）" class="headerlink" title="隆宝LANPOS IC-85B 双行英文型（9600）"></a>隆宝LANPOS IC-85B 双行英文型（9600）</h2><p>这是通过拿到的byte数据转 new String(date,”gbk”)获取到的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QA合计:        531607.11</span><br><span class="line">FFESCQA合计:        531607.11</span><br></pre></td></tr></table></figure>

<h2 id="隆宝LANPOS-IC-851-A单行11位数字（9600）"><a href="#隆宝LANPOS-IC-851-A单行11位数字（9600）" class="headerlink" title="隆宝LANPOS IC-851 A单行11位数字（9600）"></a>隆宝LANPOS IC-851 A单行11位数字（9600）</h2><p>这是通过拿到的byte数据转 new String(date,”gbk”)获取到的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QA合计:        531607.11</span><br><span class="line">FFESCQA合计:        531607.11</span><br></pre></td></tr></table></figure>

<h2 id="桑达PD8000A（2400）"><a href="#桑达PD8000A（2400）" class="headerlink" title="桑达PD8000A（2400）"></a>桑达PD8000A（2400）</h2><p>这是通过拿到的byte数据转 new String(date,”gbk”)获取到的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QA小计:             0.01QB合计:           150.18</span><br><span class="line">FFESCQA小计:         0.01ESCQA合计:           150.18</span><br></pre></td></tr></table></figure>

<h2 id="桑达PD-8000A（9600）"><a href="#桑达PD-8000A（9600）" class="headerlink" title="桑达PD-8000A（9600）"></a>桑达PD-8000A（9600）</h2><p>这是通过拿到的byte数据转 new String(date,”gbk”)获取到的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QA合计:        531607.11</span><br><span class="line">ESCQA合计:        531607.11</span><br></pre></td></tr></table></figure>

<h2 id="海信HK-VC108（9600）"><a href="#海信HK-VC108（9600）" class="headerlink" title="海信HK_VC108（9600）"></a>海信HK_VC108（9600）</h2><p>这是通过拿到的byte数据转 new String(date,”gbk”)获取到的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QA合计:86.55</span><br><span class="line">FFESCQA合计:86.55</span><br></pre></td></tr></table></figure>

<h2 id="海信VC210a（2400）"><a href="#海信VC210a（2400）" class="headerlink" title="海信VC210a（2400）"></a>海信VC210a（2400）</h2><p>这是通过拿到的byte数据转 new String(date,”gbk”)获取到的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QA合计:86.55</span><br><span class="line">FFESCQA合计:86.55</span><br></pre></td></tr></table></figure>

<h2 id="吉成VFD8C（2400）"><a href="#吉成VFD8C（2400）" class="headerlink" title="吉成VFD8C（2400）"></a>吉成VFD8C（2400）</h2><p>这是通过拿到的byte数据转 new String(date,”gbk”)获取到的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QA合计:86.55</span><br><span class="line">FFESCQA合计:86.55</span><br></pre></td></tr></table></figure>

<h2 id="商基单行11位客显（9600）"><a href="#商基单行11位客显（9600）" class="headerlink" title="商基单行11位客显（9600）"></a>商基单行11位客显（9600）</h2><p>这是通过拿到的byte数据转 new String(date,”gbk”)获取到的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QA合计:86.55</span><br><span class="line">FFESCQA合计:86.55</span><br></pre></td></tr></table></figure>

<h2 id="托利多ISMART-P-EVO-客显（2400）"><a href="#托利多ISMART-P-EVO-客显（2400）" class="headerlink" title="托利多ISMART-P/-EVO 客显（2400）"></a>托利多ISMART-P/-EVO 客显（2400）</h2><p>很贵1-3万<br>这是通过拿到的byte数据转 new String(date,”gbk”)获取到的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1C��[2;1H合计:529.54</span><br><span class="line">EOTSOHFF1CETBUS  SOFFESC[2;1H合计:529.54</span><br></pre></td></tr></table></figure>

<h2 id="托利多ISMART-S-5-7”-客显（2400）"><a href="#托利多ISMART-S-5-7”-客显（2400）" class="headerlink" title="托利多ISMART-S 5.7” 客显（2400）"></a>托利多ISMART-S 5.7” 客显（2400）</h2><p>这是通过拿到的byte数据转 new String(date,”gbk”)获取到的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1C��[2;1H合计:529.54</span><br><span class="line">EOTSOHFF1CETBUS  SOFFESC[2;1H合计:529.54</span><br></pre></td></tr></table></figure>

<h2 id="易捷通GP1135A01B客显（9600）"><a href="#易捷通GP1135A01B客显（9600）" class="headerlink" title="易捷通GP1135A01B客显（9600）"></a>易捷通GP1135A01B客显（9600）</h2><p>很贵，暂时没看到匹配的波特率</p>
<p>这是通过拿到的byte数据转 new String(date,”gbk”)获取到的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QA小计:             0.01QB合计:           150.18</span><br><span class="line">FFESCQA小计:         0.01ESCQA合计:           150.18</span><br></pre></td></tr></table></figure>

<h1 id="数字客显"><a href="#数字客显" class="headerlink" title="数字客显"></a>数字客显</h1><h2 id="川田科技CITAQ-PD-VFD810（2400）"><a href="#川田科技CITAQ-PD-VFD810（2400）" class="headerlink" title="川田科技CITAQ PD-VFD810（2400）"></a>川田科技CITAQ PD-VFD810（2400）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QA303.42</span><br><span class="line">FFESCQA303.42</span><br></pre></td></tr></table></figure>

<h2 id="川田科技DIY-POS-PD-VFD8C（2400）"><a href="#川田科技DIY-POS-PD-VFD8C（2400）" class="headerlink" title="川田科技DIY-POS PD-VFD8C（2400）"></a>川田科技DIY-POS PD-VFD8C（2400）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s0s2QA317.45</span><br><span class="line">ESCs0ESCs2FFESCQA317.45</span><br></pre></td></tr></table></figure>

<h2 id="川田科技PD-VFD8CV（2400）"><a href="#川田科技PD-VFD8CV（2400）" class="headerlink" title="川田科技PD-VFD8CV（2400）"></a>川田科技PD-VFD8CV（2400）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s0s2QA317.45</span><br><span class="line">ESCs0ESCs2FFESCQA317.45</span><br></pre></td></tr></table></figure>

<h2 id="吉成314LED（2400）"><a href="#吉成314LED（2400）" class="headerlink" title="吉成314LED（2400）"></a>吉成314LED（2400）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QA合计:86.55</span><br><span class="line">FFESCQA合计:86.55</span><br></pre></td></tr></table></figure>

<h2 id="寺冈DIGI-5800RM（9600）"><a href="#寺冈DIGI-5800RM（9600）" class="headerlink" title="寺冈DIGI-5800RM（9600）"></a>寺冈DIGI-5800RM（9600）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">   QA5.29QB340.65</span><br><span class="line">   FFESCQA5.29ESCQB340.65</span><br></pre></td></tr></table></figure>

<h2 id="宝获利Posiflex-100（2400）"><a href="#宝获利Posiflex-100（2400）" class="headerlink" title="宝获利Posiflex-100（2400）"></a>宝获利Posiflex-100（2400）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QA合计:86.55</span><br><span class="line">FFESCQA合计:86.55</span><br></pre></td></tr></table></figure>

<h2 id="甘雨GY-1008L-8位数字四组汉字（2400）"><a href="#甘雨GY-1008L-8位数字四组汉字（2400）" class="headerlink" title="甘雨GY-1008L 8位数字四组汉字（2400）"></a>甘雨GY-1008L 8位数字四组汉字（2400）</h2><p><strong>Q289.37</strong> 这个没有QA只有Q</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s2s3Q289.37</span><br><span class="line">ESCs2ESCs3FFESC Q289.37</span><br></pre></td></tr></table></figure>

<h2 id="甘雨GY-1011-单行11位（9600）"><a href="#甘雨GY-1011-单行11位（9600）" class="headerlink" title="甘雨GY-1011 单行11位（9600）"></a>甘雨GY-1011 单行11位（9600）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">   QA69378.83</span><br><span class="line">   QA69378.83</span><br></pre></td></tr></table></figure>

<h2 id="海信HK-VC110（9600）"><a href="#海信HK-VC110（9600）" class="headerlink" title="海信HK_VC110（9600）"></a>海信HK_VC110（9600）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s��sQA69378.80</span><br><span class="line">ESCs  ESCsSTXFFESC QA69378.80</span><br></pre></td></tr></table></figure>

<h2 id="拍档CD-7110（9600）"><a href="#拍档CD-7110（9600）" class="headerlink" title="拍档CD-7110（9600）"></a>拍档CD-7110（9600）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QC QC&quot;QA350.20</span><br><span class="line">ESCQC ESCQC&quot;FFESCQA350.20</span><br></pre></td></tr></table></figure>

<h2 id="拍档PD-1110（9600）"><a href="#拍档PD-1110（9600）" class="headerlink" title="拍档PD-1110（9600）"></a>拍档PD-1110（9600）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QC QC&quot;QA350.20</span><br><span class="line">ESCQC ESCQC&quot;FFESCQA350.20</span><br></pre></td></tr></table></figure>

<h2 id="拍档单行数字型（9600）"><a href="#拍档单行数字型（9600）" class="headerlink" title="拍档单行数字型（9600）"></a>拍档单行数字型（9600）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">   QA352.26</span><br><span class="line">   FFESCQA352.26</span><br></pre></td></tr></table></figure>

<h2 id="易捷通LED8（2400）"><a href="#易捷通LED8（2400）" class="headerlink" title="易捷通LED8（2400）"></a>易捷通LED8（2400）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s00215.26</span><br><span class="line">ESC s0 NAK SOH 0 SOH FF NAK STX 215.26</span><br></pre></td></tr></table></figure>

<h2 id="商通电子-POS70（2400）"><a href="#商通电子-POS70（2400）" class="headerlink" title="商通电子 POS70（2400）"></a>商通电子 POS70（2400）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s00215.26</span><br><span class="line">ESC s0 NAK SOH 0 SOH FF NAK STX 215.26</span><br></pre></td></tr></table></figure>

<h2 id="中崎ZQ-1088-10位数显（2400）"><a href="#中崎ZQ-1088-10位数显（2400）" class="headerlink" title="中崎ZQ-1088 10位数显（2400）"></a>中崎ZQ-1088 10位数显（2400）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s00215.26</span><br><span class="line">ESC s0 NAK SOH 0 SOH FF NAK STX 215.26</span><br></pre></td></tr></table></figure>

<h2 id="天宝TBOX-TBOX2（9600）"><a href="#天宝TBOX-TBOX2（9600）" class="headerlink" title="天宝TBOX-TBOX2（9600）"></a>天宝TBOX-TBOX2（9600）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s0s2QA350.16</span><br><span class="line">ESCs0ESCs2FFESCQA350.16</span><br></pre></td></tr></table></figure>

<h1 id="英文客显"><a href="#英文客显" class="headerlink" title="英文客显"></a>英文客显</h1><h2 id="川田科技DIY-POS-PD-LED8N（2400）"><a href="#川田科技DIY-POS-PD-LED8N（2400）" class="headerlink" title="川田科技DIY-POS PD-LED8N（2400）"></a>川田科技DIY-POS PD-LED8N（2400）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QATOT:479.55</span><br><span class="line">SOFFESCQATOT:479.55SOFF</span><br></pre></td></tr></table></figure>

<h2 id="川田科技DIY-POS-PD-LED12N（2400）"><a href="#川田科技DIY-POS-PD-LED12N（2400）" class="headerlink" title="川田科技DIY-POS PD-LED12N（2400）"></a>川田科技DIY-POS PD-LED12N（2400）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QATOT:479.55</span><br><span class="line">SOFFESCQATOT:479.55SOFF</span><br></pre></td></tr></table></figure>

<h2 id="川田科技DIY-POS-PD-VFD220（9600）"><a href="#川田科技DIY-POS-PD-VFD220（9600）" class="headerlink" title="川田科技DIY-POS PD-VFD220（9600）"></a>川田科技DIY-POS PD-VFD220（9600）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QASUB:            0.15QBTOT:          497.55</span><br><span class="line">SOFFESCQASUB:            0.15SOFFESCQBTOT:          497.55</span><br></pre></td></tr></table></figure>

<h2 id="惠普HP-PD220VFD-NQ-双行20位英文点阵VFD真空管（9600）"><a href="#惠普HP-PD220VFD-NQ-双行20位英文点阵VFD真空管（9600）" class="headerlink" title="惠普HP-PD220VFD-NQ 双行20位英文点阵VFD真空管（9600）"></a>惠普HP-PD220VFD-NQ 双行20位英文点阵VFD真空管（9600）</h2><p>这个客显是<strong>QBTOT:</strong>+价格</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@LASUB:            0.01QBTOT:          367.99</span><br><span class="line">ESC@ESCLASUB:            0.01ESCQBTOT:          367.99</span><br></pre></td></tr></table></figure>

<h2 id="惠普HP-PD220VFD-NQT70PS-AB2（9600）"><a href="#惠普HP-PD220VFD-NQT70PS-AB2（9600）" class="headerlink" title="惠普HP-PD220VFD-NQT70PS#AB2（9600）"></a>惠普HP-PD220VFD-NQT70PS#AB2（9600）</h2><p>这个客显是<strong>QBTOT:</strong>+价格</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LASUB:            0.01QBTOT:          371.00</span><br><span class="line">FFESCLASUB:            0.01ESCQBTOT:          371.00</span><br></pre></td></tr></table></figure>

<h2 id="IBM-POS300-4614-P80-双行20字客显（9600）"><a href="#IBM-POS300-4614-P80-双行20字客显（9600）" class="headerlink" title="IBM POS300/4614 P80 双行20字客显（9600）"></a>IBM POS300/4614 P80 双行20字客显（9600）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LASUB:            0.01QBTOT:          371.00</span><br><span class="line">FFESCLASUB:            0.01ESCQBTOT:          371.00</span><br></pre></td></tr></table></figure>

<h2 id="IBM-POS300-4614-P80-双行20字客显（9600）-1"><a href="#IBM-POS300-4614-P80-双行20字客显（9600）-1" class="headerlink" title="IBM POS300/4614 P80 双行20字客显（9600）"></a>IBM POS300/4614 P80 双行20字客显（9600）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LATOT:          378.57</span><br><span class="line">FFESCLATOT:          378.57</span><br></pre></td></tr></table></figure>

<h2 id="宝获利-PD300-可显示2行且每行可达20个字（9600）"><a href="#宝获利-PD300-可显示2行且每行可达20个字（9600）" class="headerlink" title="宝获利 PD300 可显示2行且每行可达20个字（9600）"></a>宝获利 PD300 可显示2行且每行可达20个字（9600）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QASUB:            0.01QBTOT:          371.00</span><br><span class="line">FFESCQASUB:            0.01ESCQBTOT:          371.00</span><br></pre></td></tr></table></figure>

<h2 id="宝获利-POSIFLEX-PD-2101-2x20字符（9600）"><a href="#宝获利-POSIFLEX-PD-2101-2x20字符（9600）" class="headerlink" title="宝获利 POSIFLEX PD-2101 2x20字符（9600）"></a>宝获利 POSIFLEX PD-2101 2x20字符（9600）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SUB:            3.00</span><br><span class="line">   TOT:          517.45</span><br><span class="line">SOFFSUB:            3.00DC2</span><br><span class="line">   SOFFTOT:          517.45DC2</span><br></pre></td></tr></table></figure>

<h2 id="宝获利-POSIFLEX-PD-2200-2x20字符（9600）"><a href="#宝获利-POSIFLEX-PD-2200-2x20字符（9600）" class="headerlink" title="宝获利 POSIFLEX PD-2200 2x20字符（9600）"></a>宝获利 POSIFLEX PD-2200 2x20字符（9600）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TOT:          504.94</span><br><span class="line">   </span><br><span class="line">SOSYNTOT:          504.94DLESYN</span><br><span class="line">   NAK</span><br></pre></td></tr></table></figure>

<h2 id="宝获利-POSIFLEX-PD-7000-可显示2行且每行可达10个汉字（9600）"><a href="#宝获利-POSIFLEX-PD-7000-可显示2行且每行可达10个汉字（9600）" class="headerlink" title="宝获利 POSIFLEX PD-7000 可显示2行且每行可达10个汉字（9600）"></a>宝获利 POSIFLEX PD-7000 可显示2行且每行可达10个汉字（9600）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SUB:            0.01</span><br><span class="line">TOT:          497.62</span><br><span class="line">NAKSUB:            0.01DLESYN</span><br><span class="line">NAKTOT:          497.62DLESYN</span><br></pre></td></tr></table></figure>

<h2 id="唯拓VT-LED8CV-高亮度8位数码客显（2400）"><a href="#唯拓VT-LED8CV-高亮度8位数码客显（2400）" class="headerlink" title="唯拓VT-LED8CV 高亮度8位数码客显（2400）"></a>唯拓VT-LED8CV 高亮度8位数码客显（2400）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QATOT:          437.33</span><br><span class="line">NAKESCQATOT:          437.33NAK</span><br></pre></td></tr></table></figure>

<h2 id="莹浦通WD-202-英文20个字2行（2400）"><a href="#莹浦通WD-202-英文20个字2行（2400）" class="headerlink" title="莹浦通WD-202 英文20个字2行（2400）"></a>莹浦通WD-202 英文20个字2行（2400）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QASUB:            1.50QBTOT:          438.86</span><br><span class="line">NAKESCQASUB:            1.50NAKESCQBTOT:          438.86</span><br></pre></td></tr></table></figure>

<h2 id="德利多富WINCOR-NIXDORF-双行英文型（9600）"><a href="#德利多富WINCOR-NIXDORF-双行英文型（9600）" class="headerlink" title="德利多富WINCOR NIXDORF 双行英文型（9600）"></a>德利多富WINCOR NIXDORF 双行英文型（9600）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[2J[1;1HSUB:            9.50[1I[2;1HTOT:          414.73</span><br><span class="line">ESC[2JESC[1;1HSUB:            9.50ESC[1IESC[2;1HTOT:          414.73</span><br></pre></td></tr></table></figure>

<h2 id="中崎ZQ-8DL-8位VFD数码字符（2400）"><a href="#中崎ZQ-8DL-8位VFD数码字符（2400）" class="headerlink" title="中崎ZQ-8DL 8位VFD数码字符（2400）"></a>中崎ZQ-8DL 8位VFD数码字符（2400）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">   QATOT:          446.39[1I</span><br><span class="line">   FFESCQATOT:          446.39ESC[1I</span><br></pre></td></tr></table></figure>

<h2 id="中崎ZQ-8DLII-8位VFD数码字符（2400）"><a href="#中崎ZQ-8DLII-8位VFD数码字符（2400）" class="headerlink" title="中崎ZQ-8DLII 8位VFD数码字符（2400）"></a>中崎ZQ-8DLII 8位VFD数码字符（2400）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@QATOT:          448.41[1I</span><br><span class="line">   ESC@ESCQATOT:          448.41ESC[1I</span><br></pre></td></tr></table></figure>

<h2 id="桑达PD100A-双行中文（2400）"><a href="#桑达PD100A-双行中文（2400）" class="headerlink" title="桑达PD100A 双行中文（2400）"></a>桑达PD100A 双行中文（2400）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@QATOT:          448.41[1I</span><br><span class="line">   ESC@ESCQATOT:          448.41ESC[1I</span><br></pre></td></tr></table></figure>

<h2 id="亚仿PD-100C单行串口中文型（9600）"><a href="#亚仿PD-100C单行串口中文型（9600）" class="headerlink" title="亚仿PD-100C单行串口中文型（9600）"></a>亚仿PD-100C单行串口中文型（9600）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1CTOT:  523.47</span><br><span class="line">EOTSOHFF1CETBEOTSTXTOT:  523.47EOTSOFF</span><br></pre></td></tr></table></figure>

<h2 id="东芝LIUST-51-双行英文客显（9600）"><a href="#东芝LIUST-51-双行英文客显（9600）" class="headerlink" title="东芝LIUST-51 双行英文客显（9600）"></a>东芝LIUST-51 双行英文客显（9600）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1C[1;1HSUB:            1.50[2;1HTOT:          529.49</span><br><span class="line">EOTSOHFF1CETBESC[1;1HSUB:            1.50SOFFESC[2;1HTOT:          529.49</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/25/Android USB节点获取跟踪/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Steve">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Steve's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/25/Android USB节点获取跟踪/" class="post-title-link" itemprop="url">Android USB节点获取跟踪</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-25 13:06:28" itemprop="dateCreated datePublished" datetime="2019-06-25T13:06:28+08:00">2019-06-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-26 12:44:31" itemprop="dateModified" datetime="2019-06-26T12:44:31+08:00">2019-06-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术总结/" itemprop="url" rel="index"><span itemprop="name">技术总结</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>公司项目中要经常用到usb输入，比如外接键盘，摄像头。我们平时一般都是通过UsbManager来获取节点然后进行数据的读取。UsbManager是怎么获取节点信息的呢?我们能否不通过UsbManager来读写数据呢？我们来一步步跟踪一下系统源码。</p>
<h2 id="跟踪usb源码调用流程"><a href="#跟踪usb源码调用流程" class="headerlink" title="跟踪usb源码调用流程"></a>跟踪usb源码调用流程</h2><p>先说结论：最终的实现在usbhost.c这个方法里面</p>
<blockquote>
<p><a href="http://androidxref.com/8.1.0_r33/xref/frameworks/base/core/java/android/hardware/usb/UsbManager.java" target="_blank" rel="noopener">UsbManager</a>调用getDeviceList</p>
</blockquote>
<p>关键方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">private final IUsbManager mService;</span><br><span class="line"></span><br><span class="line">310    /**</span><br><span class="line">311     * Returns a HashMap containing all USB devices currently attached.</span><br><span class="line">312     * USB device name is the key for the returned HashMap.</span><br><span class="line">313     * The result will be empty if no devices are attached, or if</span><br><span class="line">314     * USB host mode is inactive or unsupported.</span><br><span class="line">315     *</span><br><span class="line">316     * @return HashMap containing all connected USB devices.</span><br><span class="line">317     */</span><br><span class="line">318    public HashMap&lt;String,UsbDevice&gt; getDeviceList() &#123;</span><br><span class="line">319        HashMap&lt;String,UsbDevice&gt; result = new HashMap&lt;String,UsbDevice&gt;();</span><br><span class="line">320        if (mService == null) &#123;</span><br><span class="line">321            return result;</span><br><span class="line">322        &#125;</span><br><span class="line">323        Bundle bundle = new Bundle();</span><br><span class="line">324        try &#123;</span><br><span class="line">325            mService.getDeviceList(bundle);</span><br><span class="line">326            for (String name : bundle.keySet()) &#123;</span><br><span class="line">327                result.put(name, (UsbDevice)bundle.get(name));</span><br><span class="line">328            &#125;</span><br><span class="line">329            return result;</span><br><span class="line">330        &#125; catch (RemoteException e) &#123;</span><br><span class="line">331            throw e.rethrowFromSystemServer();</span><br><span class="line">332        &#125;</span><br><span class="line">333    &#125;</span><br></pre></td></tr></table></figure>

<p>我们看到其实他是调用了<a href="http://androidxref.com/8.1.0_r33/xref/frameworks/base/core/java/android/hardware/usb/IUsbManager.aidl" target="_blank" rel="noopener">IUsbManager.aidl</a>（/frameworks/base/core/java/android/hardware/usb/IUsbManager.aidl）的getDeviceList方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">28/** @hide */</span><br><span class="line">29interface IUsbManager</span><br><span class="line">30&#123;</span><br><span class="line">31    /* Returns a list of all currently attached USB devices */</span><br><span class="line">32    void getDeviceList(out Bundle devices);</span><br></pre></td></tr></table></figure>

<p>IUsbManager.aidl的getDeviceList方法和openDevice方法都定义的是aidl，那么必须要找到他的实现类。经查找，找到了<a href="http://androidxref.com/8.1.0_r33/xref/frameworks/base/services/usb/java/com/android/server/usb/UsbService.java" target="_blank" rel="noopener">UsbService</a>（/frameworks/base/services/usb/java/com/android/server/usb/UsbService.java）类实现了getDeviceList方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">private UsbHostManager mHostManager;</span><br><span class="line"></span><br><span class="line">   /* Returns a list of all currently attached USB devices (host mdoe) */</span><br><span class="line">   @Override</span><br><span class="line">   public void getDeviceList(Bundle devices) &#123;</span><br><span class="line">       if (mHostManager != null) &#123;</span><br><span class="line">           mHostManager.getDeviceList(devices);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>实际是调用了UsbHostManager的getDeviceList方法</p>
<p><a href="http://androidxref.com/8.1.0_r33/xref/frameworks/base/services/usb/java/com/android/server/usb/UsbHostManager.java" target="_blank" rel="noopener">UsbHostManager</a>的getDeviceList方法其实是直接拿到了mDevices来填充device。mDevices的key经过后来分析，其实就是devices的name，比如：/dev/bus/usb/001</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">53    // contains all connected USB devices</span><br><span class="line">54    private final HashMap&lt;String, UsbDevice&gt; mDevices = new HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">316    /* Returns a list of all currently attached USB devices */</span><br><span class="line">317    public void getDeviceList(Bundle devices) &#123;</span><br><span class="line">318        synchronized (mLock) &#123;</span><br><span class="line">319            for (String name : mDevices.keySet()) &#123;</span><br><span class="line">320                devices.putParcelable(name, mDevices.get(name));</span><br><span class="line">321            &#125;</span><br><span class="line">322        &#125;</span><br><span class="line">323    &#125;</span><br></pre></td></tr></table></figure>

<p>mDevices对象就是所有的devices，我们继续看一下 mDevices怎么来的。UsbHostManager.java方法中有beginUsbDeviceAdded和endUsbDeviceAdded方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">    /* Called from JNI in monitorUsbHostBus() to finish adding a new device */</span><br><span class="line">238    @SuppressWarnings(&quot;unused&quot;)</span><br><span class="line">239    private void endUsbDeviceAdded() &#123;</span><br><span class="line">240        if (DEBUG) &#123;</span><br><span class="line">241            Slog.d(TAG, &quot;usb:UsbHostManager.endUsbDeviceAdded()&quot;);</span><br><span class="line">242        &#125;</span><br><span class="line">243        if (mNewInterface != null) &#123;</span><br><span class="line">244            mNewInterface.setEndpoints(</span><br><span class="line">245                    mNewEndpoints.toArray(new UsbEndpoint[mNewEndpoints.size()]));</span><br><span class="line">246        &#125;</span><br><span class="line">247        if (mNewConfiguration != null) &#123;</span><br><span class="line">248            mNewConfiguration.setInterfaces(</span><br><span class="line">249                    mNewInterfaces.toArray(new UsbInterface[mNewInterfaces.size()]));</span><br><span class="line">250        &#125;</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253        synchronized (mLock) &#123;</span><br><span class="line">254            if (mNewDevice != null) &#123;</span><br><span class="line">255                mNewDevice.setConfigurations(</span><br><span class="line">256                        mNewConfigurations.toArray(</span><br><span class="line">257                                new UsbConfiguration[mNewConfigurations.size()]));</span><br><span class="line">258                mDevices.put(mNewDevice.getDeviceName(), mNewDevice);</span><br><span class="line">259                Slog.d(TAG, &quot;Added device &quot; + mNewDevice);</span><br><span class="line">260</span><br><span class="line">261                // It is fine to call this only for the current user as all broadcasts are sent to</span><br><span class="line">262                // all profiles of the user and the dialogs should only show once.</span><br><span class="line">263                ComponentName usbDeviceConnectionHandler = getUsbDeviceConnectionHandler();</span><br><span class="line">264                if (usbDeviceConnectionHandler == null) &#123;</span><br><span class="line">265                    getCurrentUserSettings().deviceAttached(mNewDevice);</span><br><span class="line">266                &#125; else &#123;</span><br><span class="line">267                    getCurrentUserSettings().deviceAttachedForFixedHandler(mNewDevice,</span><br><span class="line">268                            usbDeviceConnectionHandler);</span><br><span class="line">269                &#125;</span><br><span class="line">270                // deviceName is something like: &quot;/dev/bus/usb/001/001&quot;</span><br><span class="line">271                UsbDescriptorParser parser = new UsbDescriptorParser();</span><br><span class="line">272                boolean isInputHeadset = false;</span><br><span class="line">273                boolean isOutputHeadset = false;</span><br><span class="line">274                if (parser.parseDevice(mNewDevice.getDeviceName())) &#123;</span><br><span class="line">275                    isInputHeadset = parser.isInputHeadset();</span><br><span class="line">276                    isOutputHeadset = parser.isOutputHeadset();</span><br><span class="line">277                    Slog.i(TAG, &quot;---- isHeadset[in: &quot; + isInputHeadset</span><br><span class="line">278                            + &quot; , out: &quot; + isOutputHeadset + &quot;]&quot;);</span><br><span class="line">279                &#125;</span><br><span class="line">280                mUsbAlsaManager.usbDeviceAdded(mNewDevice,</span><br><span class="line">281                        isInputHeadset, isOutputHeadset);</span><br><span class="line">282            &#125; else &#123;</span><br><span class="line">283                Slog.e(TAG, &quot;mNewDevice is null in endUsbDeviceAdded&quot;);</span><br><span class="line">284            &#125;</span><br><span class="line">285            mNewDevice = null;</span><br><span class="line">286            mNewConfigurations = null;</span><br><span class="line">287            mNewInterfaces = null;</span><br><span class="line">288            mNewEndpoints = null;</span><br><span class="line">289            mNewConfiguration = null;</span><br><span class="line">290            mNewInterface = null;</span><br><span class="line">291        &#125;</span><br><span class="line">292    &#125;</span><br></pre></td></tr></table></figure>

<p>这2个方法就是开始和结束添加deive的方法，mNewDevice就是开始生成一个新device，我们看方法的介绍，都提到了monitorUsbHostBus方法。这monitorUsbHostBus这个方法是jni方法，那到底是谁调用的呢？我们继续跟踪一下。UsbHostManager还有一个systemReady方法，看名字估计是系统准备好了就会调用。这个方法调用了monitorUsbHostBus这个jni方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">380</span><br><span class="line">381    private native void monitorUsbHostBus();</span><br><span class="line">382    private native ParcelFileDescriptor nativeOpenDevice(String deviceName);</span><br><span class="line"></span><br><span class="line">307    public void systemReady() &#123;</span><br><span class="line">308        synchronized (mLock) &#123;</span><br><span class="line">309            // Create a thread to call into native code to wait for USB host events.</span><br><span class="line">310            // This thread will call us back on usbDeviceAdded and usbDeviceRemoved.</span><br><span class="line">311            Runnable runnable = this::monitorUsbHostBus;</span><br><span class="line">312            new Thread(null, runnable, &quot;UsbService host thread&quot;).start();</span><br><span class="line">313        &#125;</span><br><span class="line">314    &#125;</span><br></pre></td></tr></table></figure>

<p>经过查找，<a href="http://androidxref.com/8.1.0_r33/xref/frameworks/base/services/core/jni/com_android_server_UsbHostManager.cpp" target="_blank" rel="noopener">com_android_server_UsbHostManager.cpp</a>（/frameworks/base/services/core/jni/com_android_server_UsbHostManager.cpp）中实现了monitorUsbHostBus方法。</p>
<p>monitorUsbHostBus方法跟踪</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">196static const JNINativeMethod method_table[] = &#123;</span><br><span class="line">197    &#123; &quot;monitorUsbHostBus&quot;, &quot;()V&quot;, (void*)android_server_UsbHostManager_monitorUsbHostBus &#125;,</span><br><span class="line">198    &#123; &quot;nativeOpenDevice&quot;,  &quot;(Ljava/lang/String;)Landroid/os/ParcelFileDescriptor;&quot;,</span><br><span class="line">199                                  (void*)android_server_UsbHostManager_openDevice &#125;,</span><br><span class="line">200&#125;;</span><br><span class="line"></span><br><span class="line">static void android_server_UsbHostManager_monitorUsbHostBus(JNIEnv* /* env */, jobject thiz)</span><br><span class="line">160&#123;</span><br><span class="line">161    struct usb_host_context* context = usb_host_init();</span><br><span class="line">162    if (!context) &#123;</span><br><span class="line">163        ALOGE(&quot;usb_host_init failed&quot;);</span><br><span class="line">164        return;</span><br><span class="line">165    &#125;</span><br><span class="line">166    // this will never return so it is safe to pass thiz directly</span><br><span class="line">167    usb_host_run(context, usb_device_added, usb_device_removed, NULL, (void *)thiz);</span><br><span class="line">168&#125;</span><br></pre></td></tr></table></figure>

<p>usb_host_run方法中usb_device_added实现如下，看起来是一个回调。那么usb_host_run就是关键了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">static int usb_device_added(const char *devname, void* client_data) &#123;</span><br><span class="line">61    struct usb_descriptor_header* desc;</span><br><span class="line">62    struct usb_descriptor_iter iter;</span><br><span class="line">63</span><br><span class="line">64    struct usb_device *device = usb_device_open(devname);</span><br><span class="line">65    if (!device) &#123;</span><br><span class="line">66        ALOGE(&quot;usb_device_open failed\n&quot;);</span><br><span class="line">67        return 0;</span><br><span class="line">68    &#125;</span><br><span class="line">69</span><br><span class="line">70    JNIEnv* env = AndroidRuntime::getJNIEnv();</span><br><span class="line">71    jobject thiz = (jobject)client_data;</span><br><span class="line">72    const usb_device_descriptor* deviceDesc = usb_device_get_device_descriptor(device);</span><br><span class="line">73</span><br><span class="line">74    char *manufacturer = usb_device_get_manufacturer_name(device,</span><br><span class="line">75            USB_CONTROL_TRANSFER_TIMEOUT_MS);</span><br><span class="line">76    char *product = usb_device_get_product_name(device,</span><br><span class="line">77            USB_CONTROL_TRANSFER_TIMEOUT_MS);</span><br><span class="line">78    int version = usb_device_get_version(device);</span><br><span class="line">79    char *serial = usb_device_get_serial(device,</span><br><span class="line">80            USB_CONTROL_TRANSFER_TIMEOUT_MS);</span><br><span class="line">81</span><br><span class="line">82    jstring deviceName = env-&gt;NewStringUTF(devname);</span><br><span class="line">83    jstring manufacturerName = AndroidRuntime::NewStringLatin1(env, manufacturer);</span><br><span class="line">84    jstring productName = AndroidRuntime::NewStringLatin1(env, product);</span><br><span class="line">85    jstring serialNumber = AndroidRuntime::NewStringLatin1(env, serial);</span><br><span class="line">86</span><br><span class="line">87    jboolean result = env-&gt;CallBooleanMethod(thiz, method_beginUsbDeviceAdded,</span><br><span class="line">88            deviceName, usb_device_get_vendor_id(device), usb_device_get_product_id(device),</span><br><span class="line">89            deviceDesc-&gt;bDeviceClass, deviceDesc-&gt;bDeviceSubClass, deviceDesc-&gt;bDeviceProtocol,</span><br><span class="line">90            manufacturerName, productName, version, serialNumber);</span><br><span class="line">91</span><br><span class="line">92    env-&gt;DeleteLocalRef(serialNumber);</span><br><span class="line">93    env-&gt;DeleteLocalRef(productName);</span><br><span class="line">94    env-&gt;DeleteLocalRef(manufacturerName);</span><br><span class="line">95    env-&gt;DeleteLocalRef(deviceName);</span><br><span class="line">96    free(manufacturer);</span><br><span class="line">97    free(product);</span><br><span class="line">98    free(serial);</span><br><span class="line">99</span><br><span class="line">100    if (!result) goto fail;</span><br><span class="line">101</span><br><span class="line">102    usb_descriptor_iter_init(device, &amp;iter);</span><br><span class="line">103</span><br><span class="line">104    while ((desc = usb_descriptor_iter_next(&amp;iter)) != NULL) &#123;</span><br><span class="line">105        if (desc-&gt;bDescriptorType == USB_DT_CONFIG) &#123;</span><br><span class="line">106            struct usb_config_descriptor *config = (struct usb_config_descriptor *)desc;</span><br><span class="line">107            char *name = usb_device_get_string(device, config-&gt;iConfiguration,</span><br><span class="line">108                    USB_CONTROL_TRANSFER_TIMEOUT_MS);</span><br><span class="line">109            jstring configName = AndroidRuntime::NewStringLatin1(env, name);</span><br><span class="line">110</span><br><span class="line">111            env-&gt;CallVoidMethod(thiz, method_addUsbConfiguration,</span><br><span class="line">112                    config-&gt;bConfigurationValue, configName, config-&gt;bmAttributes,</span><br><span class="line">113                    config-&gt;bMaxPower);</span><br><span class="line">114</span><br><span class="line">115            env-&gt;DeleteLocalRef(configName);</span><br><span class="line">116            free(name);</span><br><span class="line">117        &#125; else if (desc-&gt;bDescriptorType == USB_DT_INTERFACE) &#123;</span><br><span class="line">118            struct usb_interface_descriptor *interface = (struct usb_interface_descriptor *)desc;</span><br><span class="line">119            char *name = usb_device_get_string(device, interface-&gt;iInterface,</span><br><span class="line">120                    USB_CONTROL_TRANSFER_TIMEOUT_MS);</span><br><span class="line">121            jstring interfaceName = AndroidRuntime::NewStringLatin1(env, name);</span><br><span class="line">122</span><br><span class="line">123            env-&gt;CallVoidMethod(thiz, method_addUsbInterface,</span><br><span class="line">124                    interface-&gt;bInterfaceNumber, interfaceName, interface-&gt;bAlternateSetting,</span><br><span class="line">125                    interface-&gt;bInterfaceClass, interface-&gt;bInterfaceSubClass,</span><br><span class="line">126                    interface-&gt;bInterfaceProtocol);</span><br><span class="line">127</span><br><span class="line">128            env-&gt;DeleteLocalRef(interfaceName);</span><br><span class="line">129            free(name);</span><br><span class="line">130        &#125; else if (desc-&gt;bDescriptorType == USB_DT_ENDPOINT) &#123;</span><br><span class="line">131            struct usb_endpoint_descriptor *endpoint = (struct usb_endpoint_descriptor *)desc;</span><br><span class="line">132</span><br><span class="line">133            env-&gt;CallVoidMethod(thiz, method_addUsbEndpoint,</span><br><span class="line">134                    endpoint-&gt;bEndpointAddress, endpoint-&gt;bmAttributes,</span><br><span class="line">135                    __le16_to_cpu(endpoint-&gt;wMaxPacketSize), endpoint-&gt;bInterval);</span><br><span class="line">136        &#125;</span><br><span class="line">137    &#125;</span><br><span class="line">138</span><br><span class="line">139    env-&gt;CallVoidMethod(thiz, method_endUsbDeviceAdded);</span><br><span class="line">140</span><br><span class="line">141fail:</span><br><span class="line">142    usb_device_close(device);</span><br><span class="line">143    checkAndClearExceptionFromCallback(env, __FUNCTION__);</span><br><span class="line">144</span><br><span class="line">145    return 0;</span><br><span class="line">146&#125;</span><br></pre></td></tr></table></figure>

<p>继续跟踪usb_host_run方法，找到了<a href="http://androidxref.com/8.1.0_r33/xref/system/core/libusbhost/usbhost.c" target="_blank" rel="noopener">usbhost.c</a>(/system/core/libusbhost/usbhost.c)文件.这个文件实现了最终的节点获取。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">319 void usb_host_run(struct usb_host_context *context,</span><br><span class="line">310                  usb_device_added_cb added_cb,</span><br><span class="line">311                  usb_device_removed_cb removed_cb,</span><br><span class="line">312                  usb_discovery_done_cb discovery_done_cb,</span><br><span class="line">313                  void *client_data)</span><br><span class="line">314&#123;</span><br><span class="line">315    int done;</span><br><span class="line">316</span><br><span class="line">317    done = usb_host_load(context, added_cb, removed_cb, discovery_done_cb, client_data);</span><br><span class="line">318</span><br><span class="line">319    while (!done) &#123;</span><br><span class="line">320</span><br><span class="line">321        done = usb_host_read_event(context);</span><br><span class="line">322    &#125;</span><br><span class="line">323&#125; /* usb_host_run() */</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">192int usb_host_load(struct usb_host_context *context,</span><br><span class="line">193                  usb_device_added_cb added_cb,</span><br><span class="line">194                  usb_device_removed_cb removed_cb,</span><br><span class="line">195                  usb_discovery_done_cb discovery_done_cb,</span><br><span class="line">196                  void *client_data)</span><br><span class="line">197&#123;</span><br><span class="line">198    int done = 0;</span><br><span class="line">199    int i;</span><br><span class="line">200</span><br><span class="line">201    context-&gt;cb_added = added_cb;</span><br><span class="line">202    context-&gt;cb_removed = removed_cb;</span><br><span class="line">203    context-&gt;data = client_data;</span><br><span class="line">204</span><br><span class="line">205    D(&quot;Created device discovery thread\n&quot;);</span><br><span class="line">206</span><br><span class="line">207    /* watch for files added and deleted within USB_FS_DIR */</span><br><span class="line">208    context-&gt;wddbus = -1;</span><br><span class="line">209    for (i = 0; i &lt; MAX_USBFS_WD_COUNT; i++)</span><br><span class="line">210        context-&gt;wds[i] = -1;</span><br><span class="line">211</span><br><span class="line">212    /* watch the root for new subdirectories 通过这里观察节点变化*/</span><br><span class="line">213    context-&gt;wdd = inotify_add_watch(context-&gt;fd, DEV_DIR, IN_CREATE | IN_DELETE);</span><br><span class="line">214    if (context-&gt;wdd &lt; 0) &#123;</span><br><span class="line">215        fprintf(stderr, &quot;inotify_add_watch failed\n&quot;);</span><br><span class="line">216        if (discovery_done_cb)</span><br><span class="line">217            discovery_done_cb(client_data);</span><br><span class="line">218        return done;</span><br><span class="line">219    &#125;</span><br><span class="line">220</span><br><span class="line">221    watch_existing_subdirs(context, context-&gt;wds, MAX_USBFS_WD_COUNT);</span><br><span class="line">222</span><br><span class="line">223    /* check for existing devices first, after we have inotify set up */</span><br><span class="line">224    done = find_existing_devices(added_cb, client_data);</span><br><span class="line">225    if (discovery_done_cb)</span><br><span class="line">226        done |= discovery_done_cb(client_data);</span><br><span class="line">227</span><br><span class="line">228    return done;</span><br><span class="line">229&#125; /* usb_host_load() */</span><br><span class="line"></span><br><span class="line">// find_existing_devices 方法先获取已经存在的节点</span><br><span class="line">22/* returns true if one of the callbacks indicates we are done */</span><br><span class="line">123static int find_existing_devices(usb_device_added_cb added_cb,</span><br><span class="line">124                                  void *client_data)</span><br><span class="line">125&#123;</span><br><span class="line">126    char busname[32];</span><br><span class="line">127    DIR *busdir;</span><br><span class="line">128    struct dirent *de;</span><br><span class="line">129    int done = 0;</span><br><span class="line">130</span><br><span class="line">131    busdir = opendir(USB_FS_DIR);</span><br><span class="line">132    if(busdir == 0) return 0;</span><br><span class="line">133</span><br><span class="line">134    while ((de = readdir(busdir)) != 0 &amp;&amp; !done) &#123;</span><br><span class="line">135        if(badname(de-&gt;d_name)) continue;</span><br><span class="line">136</span><br><span class="line">137        snprintf(busname, sizeof(busname), USB_FS_DIR &quot;/%s&quot;, de-&gt;d_name);</span><br><span class="line">138        done = find_existing_devices_bus(busname, added_cb,</span><br><span class="line">139                                         client_data);</span><br><span class="line">140    &#125; //end of busdir while</span><br><span class="line">141    closedir(busdir);</span><br><span class="line">142</span><br><span class="line">143    return done;</span><br><span class="line">144&#125;</span><br></pre></td></tr></table></figure>

<p>终于找到了最终的方法,也就是系统一直在监听DEV_DIR目录的节点变化来向上传递事件。最终通过com_android_server_UsbHostManager.cpp的jni方法（c++调用java）UsbHostManager的beginUsbDeviceAdded和endUsbDeviceAdded方法添加节点到mDevices列数。当UsbManager通过IUsbManager的实现类UsbService来获取列表，UsbService通过UsbHostManager来获取mDevices的数据并通过Bundle返回。</p>
<p>有几个关键path我们值得关注，DEV_DIR是usb节点的默认监控位置。对应linux的/dev 路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">58#define DEV_DIR             &quot;/dev&quot;</span><br><span class="line">59#define DEV_BUS_DIR         DEV_DIR &quot;/bus&quot;</span><br><span class="line">60#define USB_FS_DIR          DEV_BUS_DIR &quot;/usb&quot;</span><br><span class="line">61#define USB_FS_ID_SCANNER   USB_FS_DIR &quot;/%d/%d&quot;</span><br><span class="line">62#define USB_FS_ID_FORMAT    USB_FS_DIR &quot;/%03d/%03d&quot;</span><br><span class="line"></span><br><span class="line">context-&gt;wdd = inotify_add_watch(context-&gt;fd, DEV_DIR, IN_CREATE | IN_DELETE);</span><br></pre></td></tr></table></figure>

<p>总结：这次分析了usb节点的查找和获取方式.如果我们有了读写/dev/bus/usb/001节点的权限，那么完全可以绕过系统的UsbManager来处理usb摄像头等数据，当然就也不需要弹窗授权就可以读取。</p>
<blockquote>
<p>附上一个usb节点的信息，cat /proc/bus/input/devices就可以查看，这些信息和device的信息类似，我们关注的是<br>I: Bus=0003 Vendor=2dbb Product=0300 Version=0100<br>N: Name=”Hjimi,Inc.A200 3DSenor”<br>这2行，Vendor和Product和Name能区分出设备的类型。如果我们app只处理某种摄像头，就可以通过这个判断。</p>
</blockquote>
<h1 id="查看Android输入设置的信息"><a href="#查看Android输入设置的信息" class="headerlink" title="查看Android输入设置的信息"></a>查看Android输入设置的信息</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">/system/bin/sh: cd: /proc/bus/input/devices: Not a directory</span><br><span class="line">2|tb8735ap1_bsp_lr:/dev/input # cat /proc/bus/input/devices</span><br><span class="line">I: Bus=0019 Vendor=2454 Product=6500 Version=0010</span><br><span class="line">N: Name=&quot;mtk-kpd&quot;</span><br><span class="line">P: Phys=</span><br><span class="line">S: Sysfs=/devices/soc/10003000.keypad/input/input0</span><br><span class="line">U: Uniq=</span><br><span class="line">H: Handlers=gpufreq_ib event0 keychord</span><br><span class="line">B: PROP=0</span><br><span class="line">B: EV=3</span><br><span class="line">B: KEY=8000 0 40000401 9e37c8 0 0 10004ffc</span><br><span class="line"></span><br><span class="line">I: Bus=0000 Vendor=0000 Product=9110 Version=1060</span><br><span class="line">N: Name=&quot;mtk-tpd&quot;</span><br><span class="line">P: Phys=</span><br><span class="line">S: Sysfs=/devices/virtual/input/input1</span><br><span class="line">U: Uniq=</span><br><span class="line">H: Handlers=gpufreq_ib event1</span><br><span class="line">B: PROP=2</span><br><span class="line">B: EV=b</span><br><span class="line">B: KEY=400 0 0 0 0 0 0 0 0 0 0</span><br><span class="line">B: ABS=2630000 1000003</span><br><span class="line"></span><br><span class="line">I: Bus=0003 Vendor=2dbb Product=0203 Version=0100</span><br><span class="line">N: Name=&quot;Hjimi,Inc. A200 HD Video device&quot;</span><br><span class="line">P: Phys=usb-musb-hdrc.0.auto-1.1.1/button</span><br><span class="line">S: Sysfs=/devices/platform/mt_usb/musb-hdrc.0.auto/usb1/1-1/1-1.1/1-1.1.1/1-1.1.1:1.0/input/input88</span><br><span class="line">U: Uniq=</span><br><span class="line">H: Handlers=gpufreq_ib event2</span><br><span class="line">B: PROP=0</span><br><span class="line">B: EV=3</span><br><span class="line">B: KEY=100000 0 0 0 0 0 0</span><br><span class="line"></span><br><span class="line">I: Bus=0003 Vendor=2dbb Product=0300 Version=0100</span><br><span class="line">N: Name=&quot;Hjimi,Inc.A200 3DSenor&quot;</span><br><span class="line">P: Phys=usb-musb-hdrc.0.auto-1.1.3/button</span><br><span class="line">S: Sysfs=/devices/platform/mt_usb/musb-hdrc.0.auto/usb1/1-1/1-1.1/1-1.1.3/1-1.1.3:1.0/input/input89</span><br><span class="line">U: Uniq=</span><br><span class="line">H: Handlers=gpufreq_ib event3</span><br><span class="line">B: PROP=0</span><br><span class="line">B: EV=3</span><br><span class="line">B: KEY=100000 0 0 0 0 0 0</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/21/Linux实用命令总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Steve">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Steve's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/21/Linux实用命令总结/" class="post-title-link" itemprop="url">Linux实用命令总结</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-21 13:27:05" itemprop="dateCreated datePublished" datetime="2019-06-21T13:27:05+08:00">2019-06-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-14 18:39:16" itemprop="dateModified" datetime="2019-07-14T18:39:16+08:00">2019-07-14</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术总结/" itemprop="url" rel="index"><span itemprop="name">技术总结</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>find 命令</strong></p>
</blockquote>
<p>find的命命令结构是</p>
<p>find -HLP path option tests(限定条件) action(动作)</p>
<h2 id="忽略目录查找"><a href="#忽略目录查找" class="headerlink" title="忽略目录查找"></a>忽略目录查找</h2><p>忽略dir6这个目录,查找大小大于1字节的文件</p>
<p><code>find . -size +1c -path ./dir6 -prune -o -print</code></p>
<h2 id="忽略多个目录查找"><a href="#忽略多个目录查找" class="headerlink" title="忽略多个目录查找"></a>忽略多个目录查找</h2><p>忽略dir6 和 dir3 这个目录,查找大小大于1字节的文件</p>
<p><code>find . -size +1c \( -path ./dir6 -o -path ./dir3\) -prune -o -print</code></p>
<h2 id="查找文件名"><a href="#查找文件名" class="headerlink" title="查找文件名"></a>查找文件名</h2><p> 查找修改时间是5天之内,文件名是 “st” 结尾的文件</p>
<p> <code>find . -mtime -5 -name &quot;*st&quot;</code></p>
<h2 id="查找某个用户的文件"><a href="#查找某个用户的文件" class="headerlink" title="查找某个用户的文件"></a>查找某个用户的文件</h2><p> 查找修改时间是5天之内,文件名是 “st” 结尾的文件</p>
<p> <code>find . -user steve</code></p>
<h2 id="查找test结尾的文件-并删除"><a href="#查找test结尾的文件-并删除" class="headerlink" title="查找test结尾的文件,并删除"></a>查找test结尾的文件,并删除</h2><p><code>find . -name &quot;*test&quot; |xargs rm -rf;</code></p>
<h2 id="查找当前文件并保存到file3-txt文件中"><a href="#查找当前文件并保存到file3-txt文件中" class="headerlink" title="查找当前文件并保存到file3.txt文件中"></a>查找当前文件并保存到file3.txt文件中</h2><p><code>find . -type f |xargs &gt; file3.txt ;</code></p>
<blockquote>
<p><strong>xargs命令</strong></p>
</blockquote>
<p>个人理解这是类似RXJAVA的转换器,对面前的一个命令进行进一步的处理,和exec命令类似,但是xargs能批量处理.</p>
<blockquote>
<p><strong>chmod</strong></p>
</blockquote>
<h2 id="修改文件的权限"><a href="#修改文件的权限" class="headerlink" title="修改文件的权限"></a>修改文件的权限</h2><p>u g o 分别是用户,用户组,其他用户</p>
<p><code>chmod u=rxw,g=rx,o=r file3.txt</code></p>
<h3 id="那么我们平时说的777权限又是怎么来的呢"><a href="#那么我们平时说的777权限又是怎么来的呢" class="headerlink" title="那么我们平时说的777权限又是怎么来的呢?"></a>那么我们平时说的777权限又是怎么来的呢?</h3><p>权限是通过9位的01区间授权的,111 111 111 就分别是 u g o 对应的权限.<br>3位一组,分别是对应读取,写入,执行权限.有权限就是1,没权限就是0.<br>111转10进制就是7,三组都是7,说明所有用户都有读写执行权限.</p>
<blockquote>
<p>第一位代表文件类型</p>
</blockquote>
<p>drwxrwxrwx：表示这是一个目录<br>-rwxrwxrwx：表示这是一个文件</p>
<blockquote>
<p><strong>chown</strong></p>
</blockquote>
<h2 id="修改文件的用户组"><a href="#修改文件的用户组" class="headerlink" title="修改文件的用户组"></a>修改文件的用户组</h2><p>前面steve是用户,root是用户组</p>
<p><code>chown steve:root file3.txt</code></p>
<blockquote>
<p><strong>cat</strong></p>
</blockquote>
<h2 id="查看数据"><a href="#查看数据" class="headerlink" title="查看数据"></a>查看数据</h2><p><code>cat file.txt</code></p>
<h2 id="覆盖数据"><a href="#覆盖数据" class="headerlink" title="覆盖数据"></a>覆盖数据</h2><p><code>cat &gt;file.txt</code></p>
<h2 id="追加数据"><a href="#追加数据" class="headerlink" title="追加数据"></a>追加数据</h2><p><code>cat &gt;&gt;file.txt</code></p>
<h2 id="多行编辑"><a href="#多行编辑" class="headerlink" title="多行编辑"></a>多行编辑</h2><p><code>cat &gt;&gt;file.txt&lt;&lt;EOF</code><br>content</p>
<p>EOF //结尾</p>
<p>EOF只要成对出现就可以,不需要一定是EOF</p>
<blockquote>
<p><strong>less</strong></p>
</blockquote>
<h2 id="显示文件内容"><a href="#显示文件内容" class="headerlink" title="显示文件内容"></a>显示文件内容</h2><p><code>less file.txx</code></p>
<h2 id="显示文件内容加上行号"><a href="#显示文件内容加上行号" class="headerlink" title="显示文件内容加上行号"></a>显示文件内容加上行号</h2><p><code>less -N file.txx</code></p>
<p>less 有各种子命令</p>
<p>G(shit+g)  显示最后一行<br>g          显示第一行<br>?          向上查找 n/N 可以在查到的基础上继续向下或者向上查找<br>/          向下查找<br>F          等待新的数据来显示</p>
<blockquote>
<p><strong>tail</strong></p>
</blockquote>
<h2 id="实时输出最新输入的数据-用于监控日志"><a href="#实时输出最新输入的数据-用于监控日志" class="headerlink" title="实时输出最新输入的数据,用于监控日志"></a>实时输出最新输入的数据,用于监控日志</h2><p><code>tail -f test6.txt</code></p>
<blockquote>
<p><strong>grep</strong></p>
</blockquote>
<h2 id="查找文件包含nihao的内容"><a href="#查找文件包含nihao的内容" class="headerlink" title="查找文件包含nihao的内容"></a>查找文件包含nihao的内容</h2><p><code>grep nihao file.txt</code></p>
<h2 id="查找文件包含nihao和hello的内容"><a href="#查找文件包含nihao和hello的内容" class="headerlink" title="查找文件包含nihao和hello的内容"></a>查找文件包含nihao和hello的内容</h2><p><code>grep -E &quot;nihao|hello&quot; file.txt</code></p>
<h2 id="查找文件包含nihao和hello的内容-而且忽略大小写-默认是不忽略的"><a href="#查找文件包含nihao和hello的内容-而且忽略大小写-默认是不忽略的" class="headerlink" title="查找文件包含nihao和hello的内容,而且忽略大小写,默认是不忽略的"></a>查找文件包含nihao和hello的内容,而且忽略大小写,默认是不忽略的</h2><p><code>grep -Ei &quot;nihao|hello&quot; file.txt</code></p>
<h2 id="查找文件包含nihao和hello的内容-而且忽略大小写-默认是不忽略的-并加上颜色"><a href="#查找文件包含nihao和hello的内容-而且忽略大小写-默认是不忽略的-并加上颜色" class="headerlink" title="查找文件包含nihao和hello的内容,而且忽略大小写,默认是不忽略的,并加上颜色"></a>查找文件包含nihao和hello的内容,而且忽略大小写,默认是不忽略的,并加上颜色</h2><p><code>grep -Ei --color=auto &quot;nihao|hello&quot; file.txt</code></p>
<h2 id="查找文件包含nihao和数量"><a href="#查找文件包含nihao和数量" class="headerlink" title="查找文件包含nihao和数量"></a>查找文件包含nihao和数量</h2><p><code>grep -Ei -c &quot;nihao&quot; file.txt</code></p>
<blockquote>
<p><strong>sed</strong></p>
</blockquote>
<h2 id="mac下在第二行添加123-和Linux比较比较难用"><a href="#mac下在第二行添加123-和Linux比较比较难用" class="headerlink" title="mac下在第二行添加123,和Linux比较比较难用"></a>mac下在第二行添加123,和Linux比较比较难用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i &apos;&apos; &apos;2i\</span><br><span class="line">123&apos; file1.txt</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>awk</strong></p>
</blockquote>
<h2 id="按照-分割文件内容-并显示第一和第三列"><a href="#按照-分割文件内容-并显示第一和第三列" class="headerlink" title="按照:分割文件内容,并显示第一和第三列"></a>按照:分割文件内容,并显示第一和第三列</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">steveweideMacBook-Pro:linux steve$ cat file</span><br><span class="line">102:ddd:33333</span><br><span class="line">103:fffffff:eee</span><br><span class="line">234:dfdfdf:ffdf</span><br><span class="line">102:ddd:33333</span><br><span class="line">103:fffffff:eee</span><br><span class="line">234:dfdfdf:ffdf</span><br><span class="line">102:ddd:33333</span><br><span class="line">103:fffffff:eee</span><br><span class="line">234:dfdfdf:ffdf</span><br><span class="line">steveweideMacBook-Pro:linux steve$ awk -F &quot;:&quot; &apos;&#123;print $1,$3&#125;&apos; file</span><br><span class="line">102 33333</span><br><span class="line">103 eee</span><br><span class="line">234 ffdf</span><br><span class="line">102 33333</span><br><span class="line">103 eee</span><br><span class="line">234 ffdf</span><br><span class="line">102 33333</span><br><span class="line">103 eee</span><br><span class="line">234 ffdf</span><br><span class="line">steveweideMacBook-Pro:linux steve$</span><br></pre></td></tr></table></figure>

<h2 id="整行的eee替换成12345"><a href="#整行的eee替换成12345" class="headerlink" title="整行的eee替换成12345"></a>整行的eee替换成12345</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">steveweideMacBook-Pro:linux steve$ awk &apos;&#123;gsub(&quot;eee&quot;,&quot;12345&quot;,$0);print $0&#125;&apos; file</span><br><span class="line">102:ddd:33333</span><br><span class="line">103:fffffff:12345</span><br><span class="line">234:dfdfdf:ffdf</span><br><span class="line">102:ddd:33333</span><br><span class="line">103:fffffff:12345</span><br><span class="line">234:dfdfdf:ffdf</span><br><span class="line">102:ddd:33333</span><br><span class="line">103:fffffff:12345</span><br><span class="line">234:dfdfdf:ffdf</span><br></pre></td></tr></table></figure>

<h2 id="解析出网卡的ip地址"><a href="#解析出网卡的ip地址" class="headerlink" title="解析出网卡的ip地址"></a>解析出网卡的ip地址</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">steveweideMacBook-Pro:linux steve$ ifconfig utun0</span><br><span class="line">utun0: flags=8051&lt;UP,POINTOPOINT,RUNNING,MULTICAST&gt; mtu 2000</span><br><span class="line">	inet6 fe80::715a:1638:95a4:b899%utun0 prefixlen 64 scopeid 0xa </span><br><span class="line">	nd6 options=201&lt;PERFORMNUD,DAD&gt;</span><br><span class="line">steveweideMacBook-Pro:linux steve$ ifconfig utun0|awk -F &apos; |(%)&apos; &apos;NR==2 &#123;print $2&#125;&apos; </span><br><span class="line">fe80::715a:1638:95a4:b899</span><br><span class="line">steveweideMacBook-Pro:linux steve$</span><br></pre></td></tr></table></figure>

<h2 id="统计域名访问的次数-方法1"><a href="#统计域名访问的次数-方法1" class="headerlink" title="统计域名访问的次数,方法1"></a>统计域名访问的次数,方法1</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">steveweideMacBook-Pro:linux steve$ awk -F &quot;//|/&quot; &apos;&#123;print $2&#125;&apos; file3|sort</span><br><span class="line">www.c11msss.chom</span><br><span class="line">www.c11msss.chom</span><br><span class="line">www.c11msss.chom</span><br><span class="line">www.c1333msss.chom</span><br><span class="line">www.c1333msss.chom</span><br><span class="line">www.cmsss.chom</span><br><span class="line">www.cmsss.chom</span><br><span class="line">www.cmsss.chom</span><br><span class="line">www.cmsss.chom</span><br><span class="line">www.cmsss.chom</span><br><span class="line">www.cmsss.chom</span><br><span class="line">www.cmsss.chom</span><br><span class="line">www.cmsss.chom</span><br><span class="line">www.cmsss.chom</span><br><span class="line">steveweideMacBook-Pro:linux steve$ awk -F &quot;//|/&quot; &apos;&#123;print $2&#125;&apos; file3|sort|uniq -c</span><br><span class="line">   3 www.c11msss.chom</span><br><span class="line">   2 www.c1333msss.chom</span><br><span class="line">   9 www.cmsss.chom</span><br></pre></td></tr></table></figure>

<h2 id="统计域名访问的次数-方法2"><a href="#统计域名访问的次数-方法2" class="headerlink" title="统计域名访问的次数,方法2"></a>统计域名访问的次数,方法2</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">steveweideMacBook-Pro:linux steve$ awk -F &quot;//|/&quot; &apos;&#123;hotel[$2]++;print $2,hotel[$2]&#125;&apos; file3</span><br><span class="line">www.cmsss.chom 1</span><br><span class="line">www.cmsss.chom 2</span><br><span class="line">www.cmsss.chom 3</span><br><span class="line">www.cmsss.chom 4</span><br><span class="line">www.cmsss.chom 5</span><br><span class="line">www.cmsss.chom 6</span><br><span class="line">www.cmsss.chom 7</span><br><span class="line">www.cmsss.chom 8</span><br><span class="line">www.cmsss.chom 9</span><br><span class="line">www.c11msss.chom 1</span><br><span class="line">www.c11msss.chom 2</span><br><span class="line">www.c11msss.chom 3</span><br><span class="line">www.c1333msss.chom 1</span><br><span class="line">www.c1333msss.chom 2</span><br><span class="line">steveweideMacBook-Pro:linux steve$ </span><br><span class="line">steveweideMacBook-Pro:linux steve$ awk -F &quot;//|/&quot; &apos;&#123;hotel[$2]++;print $2,hotel[$2]&#125;END&#123;for(domain in hotel)print domain,hotel[domain]&#125;&apos; file3</span><br><span class="line">www.cmsss.chom 1</span><br><span class="line">www.cmsss.chom 2</span><br><span class="line">www.cmsss.chom 3</span><br><span class="line">www.cmsss.chom 4</span><br><span class="line">www.cmsss.chom 5</span><br><span class="line">www.cmsss.chom 6</span><br><span class="line">www.cmsss.chom 7</span><br><span class="line">www.cmsss.chom 8</span><br><span class="line">www.cmsss.chom 9</span><br><span class="line">www.c11msss.chom 1</span><br><span class="line">www.c11msss.chom 2</span><br><span class="line">www.c11msss.chom 3</span><br><span class="line">www.c1333msss.chom 1</span><br><span class="line">www.c1333msss.chom 2</span><br><span class="line">www.c11msss.chom 3</span><br><span class="line">www.cmsss.chom 9</span><br><span class="line">www.c1333msss.chom 2</span><br><span class="line">steveweideMacBook-Pro:linux steve$ awk -F &quot;//|/&quot; &apos;&#123;hotel[$2]++&#125;END&#123;for(domain in hotel)print domain,hotel[domain]&#125;&apos; file3</span><br><span class="line">www.c11msss.chom 3</span><br><span class="line">www.cmsss.chom 9</span><br><span class="line">www.c1333msss.chom 2</span><br></pre></td></tr></table></figure>

<blockquote>
<p>du</p>
</blockquote>
<h2 id="显示当前文件夹文件的大小"><a href="#显示当前文件夹文件的大小" class="headerlink" title="显示当前文件夹文件的大小"></a>显示当前文件夹文件的大小</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">steveweideMacBook-Pro:linux steve$ du -ah</span><br><span class="line">8.0K	./.DS_Store</span><br><span class="line">4.0K	./file</span><br><span class="line">4.0K	./file1.txt</span><br><span class="line">4.0K	./file1.txt_s</span><br><span class="line">4.0K	./file2</span><br><span class="line">4.0K	./file3</span><br><span class="line"> 28K	.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>tar</p>
</blockquote>
<h2 id="压缩文件"><a href="#压缩文件" class="headerlink" title="压缩文件"></a>压缩文件</h2><p>zcvf命令比较常见的压缩组合,ztvf是常见的不解压查看命令,zxvf是常见的解压组合,<br>可以排除某些文件打包,不过注意相对路径和绝对路径不要混用,免得打包不成功.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">steveweideMacBook-Pro:linux steve$ tar -zcvf www.gzip www/</span><br><span class="line">a www</span><br><span class="line">a www/1.html</span><br><span class="line">a www/10.html</span><br><span class="line">a www/11.html</span><br><span class="line">a www/12.html</span><br><span class="line">a www/13.html</span><br><span class="line">a www/14.html</span><br><span class="line">a www/15.html</span><br><span class="line">a www/16.html</span><br><span class="line">a www/17.html</span><br><span class="line">a www/18.html</span><br><span class="line">a www/19.html</span><br><span class="line">a www/2.html</span><br><span class="line">a www/20.html</span><br><span class="line">a www/3.html</span><br><span class="line">a www/4.html</span><br><span class="line">a www/5.html</span><br><span class="line">a www/6.html</span><br><span class="line">a www/7.html</span><br><span class="line">a www/8.html</span><br><span class="line">a www/9.html</span><br><span class="line">steveweideMacBook-Pro:linux steve$ tar -ztvf www.gzip </span><br><span class="line">drwxr-xr-x  0 steve  staff       0  7  3 13:19 www/</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/1.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/10.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/11.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/12.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/13.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/14.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/15.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/16.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/17.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/18.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/19.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/2.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/20.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/3.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/4.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/5.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/6.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/7.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/8.html</span><br><span class="line">-rw-r--r--  0 steve  staff       0  7  3 13:19 www/9.html</span><br><span class="line">steveweideMacBook-Pro:linux steve$ tar -zxvf www.gzip -C ./temp</span><br><span class="line">x www/</span><br><span class="line">x www/1.html</span><br><span class="line">x www/10.html</span><br><span class="line">x www/11.html</span><br><span class="line">x www/12.html</span><br><span class="line">x www/13.html</span><br><span class="line">x www/14.html</span><br><span class="line">x www/15.html</span><br><span class="line">x www/16.html</span><br><span class="line">x www/17.html</span><br><span class="line">x www/18.html</span><br><span class="line">x www/19.html</span><br><span class="line">x www/2.html</span><br><span class="line">x www/20.html</span><br><span class="line">x www/3.html</span><br><span class="line">x www/4.html</span><br><span class="line">x www/5.html</span><br><span class="line">x www/6.html</span><br><span class="line">x www/7.html</span><br><span class="line">x www/8.html</span><br></pre></td></tr></table></figure>

<blockquote>
<p>gzip</p>
</blockquote>
<h2 id="压缩文件-1"><a href="#压缩文件-1" class="headerlink" title="压缩文件"></a>压缩文件</h2><p>压缩某文件,但是不能压缩文件夹,可以和tar结合起来压缩整个打包后的文件<br>也可以使用<em>gzip -c file &gt;file2.gz</em>  <em>gzip -dc www3.gzip.gz &gt;www7.gzip</em>来实现保存源文件压缩和解压</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">steveweideMacBook-Pro:linux steve$ gzip www.gzip </span><br><span class="line"></span><br><span class="line">steveweideMacBook-Pro:linux steve$ gzip -l www.gzip.gz </span><br><span class="line">  compressed uncompressed  ratio uncompressed_name</span><br><span class="line">         368          338  -8.9% www.gzip</span><br><span class="line">steveweideMacBook-Pro:linux steve$</span><br></pre></td></tr></table></figure>

<blockquote>
<p>zip/unzip</p>
</blockquote>
<h2 id="压缩文件-2"><a href="#压缩文件-2" class="headerlink" title="压缩文件"></a>压缩文件</h2><p>压缩某文件和文件夹都可以</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">steveweideMacBook-Pro:linux steve$ zip -r www9 www</span><br><span class="line">  adding: www/ (stored 0%)</span><br><span class="line">  adding: www/1.html (stored 0%)</span><br><span class="line">  adding: www/10.html (stored 0%)</span><br><span class="line">  adding: www/11.html (stored 0%)</span><br><span class="line">  adding: www/12.html (stored 0%)</span><br><span class="line">  adding: www/13.html (stored 0%)</span><br><span class="line">  adding: www/14.html (stored 0%)</span><br><span class="line">  adding: www/15.html (stored 0%)</span><br><span class="line">  adding: www/16.html (stored 0%)</span><br><span class="line">  adding: www/17.html (stored 0%)</span><br><span class="line">  adding: www/18.html (stored 0%)</span><br><span class="line">  adding: www/19.html (stored 0%)</span><br><span class="line">  adding: www/2.html (stored 0%)</span><br><span class="line">  adding: www/20.html (stored 0%)</span><br><span class="line">  adding: www/3.html (stored 0%)</span><br><span class="line">  adding: www/4.html (stored 0%)</span><br><span class="line">  adding: www/5.html (stored 0%)</span><br><span class="line">  adding: www/6.html (stored 0%)</span><br><span class="line">  adding: www/7.html (stored 0%)</span><br><span class="line">  adding: www/8.html (stored 0%)</span><br><span class="line">  adding: www/9.html (stored 0%)</span><br><span class="line"></span><br><span class="line">  steveweideMacBook-Pro:linux steve$ unzip -l www9.zip </span><br><span class="line">Archive:  www9.zip</span><br><span class="line">  Length      Date    Time    Name</span><br><span class="line">---------  ---------- -----   ----</span><br><span class="line">        0  07-03-2019 13:19   www/</span><br><span class="line">        0  07-03-2019 13:19   www/1.html</span><br><span class="line">        0  07-03-2019 13:19   www/10.html</span><br><span class="line">        0  07-03-2019 13:19   www/11.html</span><br><span class="line">        0  07-03-2019 13:19   www/12.html</span><br><span class="line">        0  07-03-2019 13:19   www/13.html</span><br><span class="line">        0  07-03-2019 13:19   www/14.html</span><br><span class="line">        0  07-03-2019 13:19   www/15.html</span><br><span class="line">        0  07-03-2019 13:19   www/16.html</span><br><span class="line">        0  07-03-2019 13:19   www/17.html</span><br><span class="line">        0  07-03-2019 13:19   www/18.html</span><br><span class="line">        0  07-03-2019 13:19   www/19.html</span><br><span class="line">        0  07-03-2019 13:19   www/2.html</span><br><span class="line">        0  07-03-2019 13:19   www/20.html</span><br><span class="line">        0  07-03-2019 13:19   www/3.html</span><br><span class="line">        0  07-03-2019 13:19   www/4.html</span><br><span class="line">        0  07-03-2019 13:19   www/5.html</span><br><span class="line">        0  07-03-2019 13:19   www/6.html</span><br><span class="line">        0  07-03-2019 13:19   www/7.html</span><br><span class="line">        0  07-03-2019 13:19   www/8.html</span><br><span class="line">        0  07-03-2019 13:19   www/9.html</span><br><span class="line">---------                     -------</span><br></pre></td></tr></table></figure>

<blockquote>
<p>kill</p>
</blockquote>
<h2 id="杀进程"><a href="#杀进程" class="headerlink" title="杀进程"></a>杀进程</h2><p>杀进程,下面这个<a href="https://www.jianshu.com/p/3d9edcd023d7" target="_blank" rel="noopener">参考</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">##一、查看指定端口的进程</span><br><span class="line">sudo lsof -i :27017</span><br><span class="line"></span><br><span class="line">COMMAND   PID    USER        FD      TYPE             DEVICE             SIZE/OFF      NODE       NAME</span><br><span class="line">[mongod]  859   zhangsan    313u      IPv6            0x1111111111111     0t0         TCP        *:cslistener (LISTEN)</span><br><span class="line"></span><br><span class="line">## 二、根据进程名称</span><br><span class="line">ps -ef | grep nginx</span><br><span class="line"></span><br><span class="line">  501 17780     1   0  8:36下午 ??         0:00.00 nginx: master process nginx</span><br><span class="line">  501 17781 17780   0  8:36下午 ??         0:00.00 nginx: worker process</span><br><span class="line">  501 17790 14611   0  8:39下午 ttys004    0:00.00 grep nginx</span><br><span class="line"></span><br><span class="line">然后根据PID杀进程：</span><br><span class="line">sudo kill -9 859</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/15/关于基于Android定制化智能硬件的一些个人感受/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Steve">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Steve's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/15/关于基于Android定制化智能硬件的一些个人感受/" class="post-title-link" itemprop="url">关于基于Android定制化智能硬件的一些个人感受</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-15 12:39:15 / 修改时间：14:15:12" itemprop="dateCreated datePublished" datetime="2019-06-15T12:39:15+08:00">2019-06-15</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/职场感想/" itemprop="url" rel="index"><span itemprop="name">职场感想</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="工作日常"><a href="#工作日常" class="headerlink" title="工作日常"></a>工作日常</h1><p>作为一名Android硬件开发工程师,每天都需要拿着各种定制化的机器调试.经常需要和硬件部门协同开发,调试.日常开发经常会使用到串口,蓝牙,wifi,修改系统配置.另外会需要和方案商讨论一些定制化功能,如开机画面,开机声音,删除通知栏,默认授予权限等.有时候扫码的时候需要用到硬件扫码硬件,这就需要和扫码模块的方案商对接使用方法.我们有一款设备需要接入键盘,和接盘厂对接键盘协议.这些都是时长开发的工作内容.</p>
<h1 id="与普通的Android开发的不同点"><a href="#与普通的Android开发的不同点" class="headerlink" title="与普通的Android开发的不同点"></a>与普通的Android开发的不同点</h1><h2 id="机器的性能普遍很差"><a href="#机器的性能普遍很差" class="headerlink" title="机器的性能普遍很差"></a>机器的性能普遍很差</h2><p>目前我接触的都是基于MTK和展讯平摊的机器.内存最少的只有512M,最大的目前也只有1G,SDCard空间也是很小,之前我们做了一款收银硬件,量产的机器的SDCard空间只有100M.如果不及时释放本地的垃圾文件,很快就满了.<br>有一次我们发现我们的app没法升级了,客户投诉来,然后我们发现是因为下载apk的时候失败了,SDCard满了.只能寄回来刷机,之后我们基本上都会安装完之后就删除掉不要的apk文件,仅仅这样还不够,系统会记录不少日志文件,也需要和方案商确认,然后每次开机的时候我们都会删除,防止下载失败的情况再次发生.</p>
<h2 id="调试麻烦"><a href="#调试麻烦" class="headerlink" title="调试麻烦"></a>调试麻烦</h2><p>由于机器的性能导致的反应慢,需要经常调试,而且因为很多机器都没法触屏,屏幕很小,我们普遍使用total control 或者Vysor来投屏到电脑来控制.即使这样,还是有一些机器没法使用投屏.这样的开发环境对比目前性能过剩的手机app来说,真的是一下子回到了几年前.<br>我们目前公司使用的机器大部分还是基于android 4.4 或者android 8.1来进行的.</p>
<h2 id="需要协调能力"><a href="#需要协调能力" class="headerlink" title="需要协调能力"></a>需要协调能力</h2><p>由于经常需要和方案商或者硬件部门打交道,所以协调能力需要比较高,承受压力的能力也要比较好才能应付来着各部门的压力.</p>
<h2 id="测试周期长"><a href="#测试周期长" class="headerlink" title="测试周期长"></a>测试周期长</h2><p>由于硬件的验收标准较高,一个功能点会反复测试,app挂掉之后需要能自启动能力</p>
<h1 id="存在的问题与困扰"><a href="#存在的问题与困扰" class="headerlink" title="存在的问题与困扰"></a>存在的问题与困扰</h1><ul>
<li><p>另外由于需要跨软件和硬件部门开发,文化冲突很明显,直接领导也不一样.硬件的项目经理往往跟进项目量产时间往前推导开发时间,为了把项目推进,往往会压榨开发的时间,开发由于产品是软件部门设计的,排期是按照正常的app开发节奏来做,和他们的时间和有较大差异.另外硬件的小毛病和系统修改也一般不计入开发时间,所以导致软硬件部门经常会互相扯皮,推诿.吵架和讨价还价能力也成了开发必备的技能之一.开发的小伙伴由于普遍是年轻的互联网思维下成长的年轻人,硬件部门一般是年纪较大的,不会开发的人.所以年龄代沟也加强了这种矛盾.</p>
</li>
<li><p>定制化开发往往很枯燥,调试一个问题周期很长,测试周期更加长,我们项目中为了适配一款简单的键盘输入,开发周期大概一个多星期,但是测试和修改的时间超过了2个月,对人的耐心是极大的挑战.</p>
</li>
</ul>
<h1 id="发展的方向"><a href="#发展的方向" class="headerlink" title="发展的方向"></a>发展的方向</h1><ul>
<li>LOT前景诱人</li>
</ul>
<p> <strong>目前互联网红利已经消耗殆尽,但是物联网的红利才刚刚开始.</strong><br>现在阿里云和腾讯云都有物联网板块,基于硬件的开发目前越来越流行,占领硬件入口必将迎来一场大战.我认为以后日活可能会从统计人变化为统计物.现在妨碍硬件开发的最大限制个个人认为是大部分软件开发人没有一个可靠的平台进行开发.虽然Android早已经推出了Android Thing,但是很明显没有得到国内大厂们的支持和推广.硬件的价格导致Android Thing很难推广得开,如现在树莓派是可以跑Android Thing的平台,但是一款树莓派不包含SDCard,都需要200多人民币.我们很多机器整机的成本价都不到200元.价格差距较大,没有量产的可能性.所以如果大厂们能提供一些优秀的平台给开发者使用,接入硬件和软件开发者,那么这个想象空间我觉得很大. </p>
<ul>
<li><p>跨平台开发<br>由于我们的机器很可能同时基于android和单片机开发,所以如果能把核心业务封装起来的话,那么不管是开发还是升级都会比较快,也能把核心业务加密起来.</p>
</li>
<li><p>MQTT等协议的熟悉<br>硬件一般需要长期在线,随时接受来自服务器端的命令.所以保持在线就成了刚需.基于MQTT和websocket的方案比较流行.那么我们熟悉这块业务对自身能力的提高也有较大好处.</p>
</li>
<li><p>其他<br>由于硬件开发比较考验技术人员的协调能力,对业务也要熟悉,这样的环境对人才的培养是很快的.</p>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/15/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Steve">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Steve's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/15/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-15 10:53:15" itemprop="dateCreated datePublished" datetime="2019-06-15T10:53:15+08:00">2019-06-15</time>
            

            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Steve</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">2</span>
                    <span class="site-state-item-name">分类</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Steve</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.1.2</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.2"></script>

  <script src="/js/motion.js?v=7.1.2"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.2"></script>



  

  


  <script src="/js/next-boot.js?v=7.1.2"></script>


  

  

  

  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
